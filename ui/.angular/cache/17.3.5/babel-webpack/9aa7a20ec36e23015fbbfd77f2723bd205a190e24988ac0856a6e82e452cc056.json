{"ast":null,"code":"import { ModalComponent } from '@ui/core/components/modal/modal.component';\nimport { Validators } from '@angular/forms';\nimport { Buckets } from \"@ui/modules/file/file.type\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services\";\nimport * as i3 from \"@ui/core/services\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/radio\";\nconst _c0 = (a0, a1) => ({\n  \"btn-loading\": a0,\n  \"btn--inactive\": a1\n});\nfunction FileDeleteModalComponent_mat_radio_button_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-radio-button\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", b_r1);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(b_r1);\n  }\n}\nfunction FileDeleteModalComponent_ng_container_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 18);\n    i0.ɵɵelement(2, \"div\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction FileDeleteModalComponent_ng_container_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Delete \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\nexport let FileDeleteModalComponent = /*#__PURE__*/(() => {\n  class FileDeleteModalComponent extends ModalComponent {\n    constructor(changeDetectorRef, elem, formBuilder, fileApiService, fileService, notificationService, trackingService) {\n      super(elem, formBuilder);\n      this.changeDetectorRef = changeDetectorRef;\n      this.elem = elem;\n      this.formBuilder = formBuilder;\n      this.fileApiService = fileApiService;\n      this.fileService = fileService;\n      this.notificationService = notificationService;\n      this.trackingService = trackingService;\n      this.isDeletingFile = false;\n      /**\n       * NOTE: The buckets and visibilities are both copied so that they are\n       * accessible from the HTML template.\n       */\n      this.buckets = Buckets;\n    }\n    ngOnInit() {\n      this.buildModalForm();\n    }\n    buildModalForm() {\n      const pathRegex = /^(?!\\/)(?!.*(?:^|\\/)\\.\\.(?:\\/|$))+/;\n      this.modalForm = this.formBuilder.group({\n        bucket: this.formBuilder.control(this.buckets[0], [Validators.required]),\n        uri: this.formBuilder.control('', [Validators.required, Validators.pattern(pathRegex)])\n      });\n    }\n    closeModal() {\n      super.closeModal();\n      this.resetModal();\n    }\n    resetModal() {\n      this.isDeletingFile = false;\n      this.buildModalForm();\n      this.changeDetectorRef.detectChanges();\n    }\n    submitModalForm() {\n      this.isDeletingFile = true;\n      const {\n        bucket,\n        uri\n      } = this.buildModalFormData();\n      this.fileApiService.deleteFile(bucket, uri).subscribe(res => {\n        this.notificationService.createNotification('Successfully deleted existing file!');\n        this.resetModal();\n      }, error => {\n        this.notificationService.createNotification(error.error.message);\n        this.isDeletingFile = false;\n      });\n    }\n    buildModalFormData() {\n      return {\n        bucket: this.fileService.getBucketName(this.modalForm.value.bucket),\n        uri: this.modalForm.value.uri\n      };\n    }\n    static #_ = this.ɵfac = function FileDeleteModalComponent_Factory(t) {\n      return new (t || FileDeleteModalComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.FileApiService), i0.ɵɵdirectiveInject(i2.FileService), i0.ɵɵdirectiveInject(i3.NotificationService), i0.ɵɵdirectiveInject(i3.TrackingService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FileDeleteModalComponent,\n      selectors: [[\"ui-file-delete-modal\"]],\n      features: [i0.ɵɵInheritDefinitionFeature],\n      decls: 29,\n      vars: 11,\n      consts: [[1, \"modal\", \"hidden\", 3, \"id\"], [1, \"modal__background\", 3, \"click\"], [1, \"modal__body\"], [1, \"modal__close-btn-container\"], [\"aria-label\", \"Close shop checkout modal\", 1, \"modal__close-btn\", 3, \"click\"], [1, \"modal__close-btn-spacer\"], [1, \"modal__content\"], [1, \"modal__header\"], [1, \"modal__info\"], [\"enctype\", \"multipart/form-data\", 1, \"editor__form\", 3, \"ngSubmit\", \"formGroup\"], [1, \"form-field\", \"editor__form-field\"], [1, \"form-field-label\", \"editor__form-field-label\"], [\"formControlName\", \"bucket\", \"name\", \"bucket\", \"required\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [\"formControlName\", \"uri\", \"required\", \"\", \"autofocus\", \"\"], [\"aria-label\", \"Select file to upload\", 1, \"btn\", \"btn--warn\", \"editor__form-btn\", \"editor__form-btn--submit\", 3, \"ngClass\", \"disabled\"], [4, \"ngIf\"], [3, \"value\"], [1, \"btn-loader-container\"], [1, \"btn-loader\", \"btn-loader--warn\"]],\n      template: function FileDeleteModalComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n          i0.ɵɵlistener(\"click\", function FileDeleteModalComponent_Template_div_click_1_listener() {\n            return ctx.closeModal();\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"div\", 2)(3, \"div\", 3)(4, \"button\", 4);\n          i0.ɵɵlistener(\"click\", function FileDeleteModalComponent_Template_button_click_4_listener() {\n            return ctx.closeModal();\n          });\n          i0.ɵɵtext(5, \" \\u2716 \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(6, \"div\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"div\", 6)(8, \"h1\", 7);\n          i0.ɵɵtext(9, \"Delete File\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"div\", 8);\n          i0.ɵɵtext(11, \" Please specify the file's corresponding bucket and URI, and it will be deleted (if it exists). \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"form\", 9);\n          i0.ɵɵlistener(\"ngSubmit\", function FileDeleteModalComponent_Template_form_ngSubmit_12_listener() {\n            return ctx.submitModalForm();\n          });\n          i0.ɵɵelementStart(13, \"div\", 10)(14, \"label\", 11);\n          i0.ɵɵtext(15, \"Bucket\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(16, \"br\")(17, \"br\");\n          i0.ɵɵelementStart(18, \"mat-radio-group\", 12);\n          i0.ɵɵtemplate(19, FileDeleteModalComponent_mat_radio_button_19_Template, 2, 2, \"mat-radio-button\", 13);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(20, \"div\", 10)(21, \"label\", 11);\n          i0.ɵɵtext(22, \"URI\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(23, \"br\")(24, \"br\")(25, \"input\", 14);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"button\", 15);\n          i0.ɵɵtemplate(27, FileDeleteModalComponent_ng_container_27_Template, 3, 0, \"ng-container\", 16)(28, FileDeleteModalComponent_ng_container_28_Template, 2, 0, \"ng-container\", 16);\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"id\", ctx.modalId);\n          i0.ɵɵadvance(12);\n          i0.ɵɵproperty(\"formGroup\", ctx.modalForm);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.buckets)(\"ngForTrackBy\", ctx.trackingService.objectById);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c0, ctx.isDeletingFile, !ctx.modalForm.valid))(\"disabled\", !ctx.modalForm.valid);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.isDeletingFile);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.isDeletingFile);\n        }\n      },\n      dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i5.MatRadioGroup, i5.MatRadioButton, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.FormGroupDirective, i1.FormControlName]\n    });\n  }\n  return FileDeleteModalComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}