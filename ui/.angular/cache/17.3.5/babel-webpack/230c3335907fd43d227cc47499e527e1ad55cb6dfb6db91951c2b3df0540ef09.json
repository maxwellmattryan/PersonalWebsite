{"ast":null,"code":"import { ShopProductStatuses } from '../../models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ui/core/auth\";\nimport * as i2 from \"@ui/modules/file/services\";\nimport * as i3 from \"@ui/core/services\";\nimport * as i4 from \"../../services\";\nimport * as i5 from \"@angular/router\";\nconst _c0 = (a0, a1) => ({\n  \"products__product-buy-btn--compress\": a0,\n  \"btn--loading\": a1\n});\nfunction ShopProductCollectionComponent_div_0_ng_container_5_ng_container_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const p_r2 = i0.ɵɵnextContext().$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", p_r2.amount <= 0 ? \"FREE\" : \"$ \" + ctx_r2.formatAmount(p_r2.amount), \" \");\n  }\n}\nfunction ShopProductCollectionComponent_div_0_ng_container_5_ng_container_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 19);\n    i0.ɵɵelement(2, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction ShopProductCollectionComponent_div_0_ng_container_5_ng_container_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function ShopProductCollectionComponent_div_0_ng_container_5_ng_container_16_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const p_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.sendProductToEditor(p_r2));\n    });\n    i0.ɵɵtext(2, \" \\u270F \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function ShopProductCollectionComponent_div_0_ng_container_5_ng_container_16_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const p_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.deleteProduct(p_r2.id));\n    });\n    i0.ɵɵtext(4, \" \\u2715 \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction ShopProductCollectionComponent_div_0_ng_container_5_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 4);\n  }\n}\nfunction ShopProductCollectionComponent_div_0_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 7)(2, \"h3\", 8);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 9)(5, \"picture\");\n    i0.ɵɵelement(6, \"source\", 10)(7, \"source\", 11)(8, \"img\", 12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"p\", 13);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\", 14);\n    i0.ɵɵelement(12, \"markdown\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function ShopProductCollectionComponent_div_0_ng_container_5_Template_a_click_13_listener() {\n      const p_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.startCheckout(p_r2));\n    });\n    i0.ɵɵtemplate(14, ShopProductCollectionComponent_div_0_ng_container_5_ng_container_14_Template, 2, 1, \"ng-container\", 17)(15, ShopProductCollectionComponent_div_0_ng_container_5_ng_container_15_Template, 3, 0, \"ng-container\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, ShopProductCollectionComponent_div_0_ng_container_5_ng_container_16_Template, 5, 0, \"ng-container\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(17, ShopProductCollectionComponent_div_0_ng_container_5_div_17_Template, 1, 0, \"div\", 18);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const p_r2 = ctx.$implicit;\n    const idx_r5 = ctx.index;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(p_r2.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"srcset\", ctx_r2.fileService.getImageUri(p_r2.image_url, \"webp\"));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"srcset\", ctx_r2.fileService.getImageUri(p_r2.image_url, \"png\"));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"alt\", p_r2.name + \" thumbnail\")(\"src\", ctx_r2.fileService.getImageUri(p_r2.image_url, \"png\"), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(p_r2.preview);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"data\", p_r2.description);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(12, _c0, ctx_r2.isAdmin, ctx_r2.isStartingCheckout && p_r2.id === ctx_r2.checkoutProductId));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !(ctx_r2.isStartingCheckout && p_r2.id === ctx_r2.checkoutProductId));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isStartingCheckout && p_r2.id === ctx_r2.checkoutProductId);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isAdmin);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", idx_r5 !== ctx_r2.products.length - 1);\n  }\n}\nfunction ShopProductCollectionComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"h2\", 3);\n    i0.ɵɵtext(2, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"div\", 4);\n    i0.ɵɵelementStart(4, \"div\", 5);\n    i0.ɵɵtemplate(5, ShopProductCollectionComponent_div_0_ng_container_5_Template, 18, 15, \"ng-container\", 6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.products)(\"ngForTrackBy\", ctx_r2.trackingService.objectById);\n  }\n}\nexport let ShopProductCollectionComponent = /*#__PURE__*/(() => {\n  class ShopProductCollectionComponent {\n    constructor(authService, fileService, notificationService, seoService, shopApiService, shopCheckoutService, shopEditorService, trackingService, router) {\n      this.authService = authService;\n      this.fileService = fileService;\n      this.notificationService = notificationService;\n      this.seoService = seoService;\n      this.shopApiService = shopApiService;\n      this.shopCheckoutService = shopCheckoutService;\n      this.shopEditorService = shopEditorService;\n      this.trackingService = trackingService;\n      this.router = router;\n      // CAUTION: This is necessary because the routing changes when this component is used outside of the shop module\n      this.baseRoute = 'shop/products';\n      this.isAdmin = false;\n      this.isStartingCheckout = false;\n      this.checkoutProductId = -1;\n      this.modalId = 'shop-checkout-modal';\n      this.timeoutFn = () => {\n        if (!this.isStartingCheckout) return;\n        this.isStartingCheckout = false;\n        this.notificationService.createNotification('Sorry, unable to initialize Stripe Checkout. Please refresh and try again.', '', 3600);\n      };\n    }\n    ngOnInit() {\n      this.isAdmin = this.authService.isLoggedIn();\n    }\n    getProductUrl(id, name) {\n      return `${this.baseRoute}/${this.seoService.getCanonicalUrl(id, name)}`;\n    }\n    showDialog() {\n      let modal = document.getElementById(this.modalId);\n      modal.classList.remove('init');\n      modal.classList.remove('hidden');\n      modal.classList.add('show');\n    }\n    sendProductToEditor(product) {\n      this.shopEditorService.setProduct(product);\n    }\n    deleteProduct(productId) {\n      if (!this.notificationService.deleteConfirmation('shop product')) return;\n      this.shopApiService.deleteProduct(productId, false).subscribe(res => {\n        this.products = this.products.filter(p => p.id !== productId);\n        this.notificationService.createNotification('Successfully deleted shop product!');\n      }, error => {\n        this.notificationService.createNotification(error.error.message);\n      });\n    }\n    formatAmount(n) {\n      return Number(n).toFixed(2);\n    }\n    startCheckout(productData) {\n      if (productData.status.id != ShopProductStatuses.AVAILABLE) {\n        this.notificationService.createNotification(`Sorry, unable to buy product because it is ${productData.status.status.toLowerCase()}.`, '', 3600);\n        return;\n      }\n      this.checkoutProductId = productData.id;\n      if (productData.amount <= 0.0) {\n        this.showDialog();\n      } else {\n        this.isStartingCheckout = true;\n        this.shopCheckoutService.goToCheckout(productData.id).subscribe(res => {\n          this.isStartingCheckout = false;\n        }, error => {\n          this.notificationService.createNotification(error.error.message);\n          this.isStartingCheckout = false;\n        });\n        setTimeout(this.timeoutFn, 10000);\n      }\n    }\n    startFreeCheckout(customerData) {\n      if (this.checkoutProductId == -1) return;\n      this.shopCheckoutService.setCustomer(customerData);\n      this.router.navigate(['shop/checkout'], {\n        queryParams: {\n          success: 'true',\n          productId: this.checkoutProductId,\n          isFreeProduct: 'true'\n        }\n      });\n    }\n    static #_ = this.ɵfac = function ShopProductCollectionComponent_Factory(t) {\n      return new (t || ShopProductCollectionComponent)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.FileApiService), i0.ɵɵdirectiveInject(i3.NotificationService), i0.ɵɵdirectiveInject(i3.SeoService), i0.ɵɵdirectiveInject(i4.ShopApiService), i0.ɵɵdirectiveInject(i4.ShopCheckoutService), i0.ɵɵdirectiveInject(i4.ShopEditorService), i0.ɵɵdirectiveInject(i3.TrackingService), i0.ɵɵdirectiveInject(i5.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ShopProductCollectionComponent,\n      selectors: [[\"ui-shop-product-collection\"]],\n      inputs: {\n        products: \"products\",\n        baseRoute: \"baseRoute\"\n      },\n      decls: 2,\n      vars: 2,\n      consts: [[\"class\", \"section products\", 4, \"ngIf\"], [3, \"modalEvent\", \"modalId\"], [1, \"section\", \"products\"], [1, \"products__header\"], [1, \"line-divider\"], [1, \"container\", \"products__product-container\"], [4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [1, \"products__product\"], [1, \"products__product-header\"], [1, \"products__product-image-container\"], [\"type\", \"image/webp\", 3, \"srcset\"], [\"type\", \"image/png\", 3, \"srcset\"], [1, \"products__product-image\", 3, \"alt\", \"src\"], [1, \"products__product-preview\"], [1, \"products__product-description\"], [3, \"data\"], [1, \"btn\", \"btn--go\", \"products__product-buy-btn\", 3, \"click\", \"ngClass\"], [4, \"ngIf\"], [\"class\", \"line-divider\", 4, \"ngIf\"], [1, \"btn-loader-container\"], [1, \"btn-loader--go\"], [\"aria-label\", \"Edit shop product\", \"routerLink\", \"/shop/products/editor\", 1, \"btn\", \"products__product-add-btn\", 3, \"click\"], [\"aria-label\", \"Delete shop product\", \"type\", \"button\", 1, \"btn\", \"btn--warn\", \"products__product-delete-btn\", 3, \"click\"]],\n      template: function ShopProductCollectionComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, ShopProductCollectionComponent_div_0_Template, 6, 2, \"div\", 0);\n          i0.ɵɵelementStart(1, \"ui-shop-checkout-modal\", 1);\n          i0.ɵɵlistener(\"modalEvent\", function ShopProductCollectionComponent_Template_ui_shop_checkout_modal_modalEvent_1_listener($event) {\n            return ctx.startFreeCheckout($event);\n          });\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"ngIf\", ctx.products);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"modalId\", ctx.modalId);\n        }\n      },\n      styles: [\"markdown[_ngcontent-%COMP%]     h1, markdown[_ngcontent-%COMP%]     h2, markdown[_ngcontent-%COMP%]     h3, markdown[_ngcontent-%COMP%]     h4, markdown[_ngcontent-%COMP%]     h5, markdown[_ngcontent-%COMP%]     h6{margin:3.5rem 0 1.5rem}markdown[_ngcontent-%COMP%]     p, markdown[_ngcontent-%COMP%]     img{margin:2rem 0}markdown[_ngcontent-%COMP%]     pre{margin:1rem 0 1.5rem}markdown[_ngcontent-%COMP%]     a{color:#aec6f1;display:inline-block}markdown[_ngcontent-%COMP%]     div img{border:1px solid black;box-sizing:border-box;text-align:center;width:100%}markdown[_ngcontent-%COMP%]     img{border:1px solid black;height:auto;text-align:center;width:100%}markdown[_ngcontent-%COMP%]     p code{background-color:#4e5d74;box-sizing:border-box;color:#fcfdff;margin:0 .25rem;padding:.125rem .25rem}markdown[_ngcontent-%COMP%]     .text--note{color:#aec6f1}markdown[_ngcontent-%COMP%]     .text--note-paragraph{color:#e1edff}markdown[_ngcontent-%COMP%]     .text--caution{color:#ffe7a0}markdown[_ngcontent-%COMP%]     .text--caution-paragraph{color:#ffefd3}markdown[_ngcontent-%COMP%]     .text--warn{color:#ffa0b6}markdown[_ngcontent-%COMP%]     .text--warn-paragraph{color:#ffd6dc}markdown[_ngcontent-%COMP%]     .text--tip{color:#9bec8f}markdown[_ngcontent-%COMP%]     .text--tip-paragraph{color:#d7ffd5}markdown[_ngcontent-%COMP%]     li{line-height:1.5rem;margin-bottom:.5rem}@media only screen and (min-width: 768px){markdown[_ngcontent-%COMP%]     a:hover{text-decoration:underline}markdown[_ngcontent-%COMP%]     img{width:64%}}.products[_ngcontent-%COMP%]{min-height:calc(41vh + 1px)}.products__product-container[_ngcontent-%COMP%]   .line-divider[_ngcontent-%COMP%]{opacity:.2;margin:1rem 0 .5rem}.products__product[_ngcontent-%COMP%]{display:grid;grid-gap:1rem;margin:0}.products__product[_ngcontent-%COMP%]   .products__product-header[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-image-container[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-preview[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-description[_ngcontent-%COMP%]{grid-column:1/3}.products__product[_ngcontent-%COMP%]   .products__product-buy-btn[_ngcontent-%COMP%]{align-self:center;text-align:center}.products__product[_ngcontent-%COMP%]   .products__product-header[_ngcontent-%COMP%]{font-size:120%;grid-row:2/3;margin-bottom:1rem}.products__product[_ngcontent-%COMP%]   .products__product-preview[_ngcontent-%COMP%]{color:#acb5c7;font-style:italic;grid-row:3/4;margin-bottom:1rem}.products__product[_ngcontent-%COMP%]   .products__product-description[_ngcontent-%COMP%]{font-size:90%;grid-row:4/5;margin-bottom:.5rem}.products__product[_ngcontent-%COMP%]   .products__product-buy-btn[_ngcontent-%COMP%]{grid-column:1/3;height:48px;line-height:48px;width:calc(.7 * 176px)}.products__product[_ngcontent-%COMP%]   .products__product-buy-btn--compress[_ngcontent-%COMP%]{justify-self:center}.products__product[_ngcontent-%COMP%]   .products__product-image-container[_ngcontent-%COMP%]{grid-row:1/2;justify-self:center;margin-bottom:1rem}.products__product[_ngcontent-%COMP%]   .products__product-image-container[_ngcontent-%COMP%]   .products__product-image[_ngcontent-%COMP%]{border:1px solid black;height:auto;width:100%;max-width:24rem}.products__product[_ngcontent-%COMP%]   .products__product-add-btn[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-delete-btn[_ngcontent-%COMP%]{align-self:center;height:48px;font-size:120%;justify-self:center;width:calc(.7 * 176px)}.products__product[_ngcontent-%COMP%]   .products__product-add-btn[_ngcontent-%COMP%]{grid-column:1/2}.products__product[_ngcontent-%COMP%]   .products__product-delete-btn[_ngcontent-%COMP%]{grid-column:2/3}@media only screen and (min-width: 1290px){.products__product-container[_ngcontent-%COMP%]   .line-divider[_ngcontent-%COMP%]{opacity:.2;margin:0}.products__product[_ngcontent-%COMP%]{grid-template-columns:15rem auto 5rem;grid-template-rows:2rem 3rem auto;margin:2rem 0}.products__product[_ngcontent-%COMP%]   .products__product-header[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-preview[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-description[_ngcontent-%COMP%]{align-self:center;grid-column:2/3;padding:.5rem;margin:0}.products__product[_ngcontent-%COMP%]   .products__product-image-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:1/4;margin:auto 0}.products__product[_ngcontent-%COMP%]   .products__product-header[_ngcontent-%COMP%]{grid-row:1/2}.products__product[_ngcontent-%COMP%]   .products__product-preview[_ngcontent-%COMP%]{grid-row:2/3}.products__product[_ngcontent-%COMP%]   .products__product-description[_ngcontent-%COMP%]{grid-row:3/4}.products__product[_ngcontent-%COMP%]   .products__product-buy-btn[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-add-btn[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-delete-btn[_ngcontent-%COMP%]{grid-column:3/4;justify-self:flex-start}.products__product[_ngcontent-%COMP%]   .products__product-buy-btn[_ngcontent-%COMP%], .products__product[_ngcontent-%COMP%]   .products__product-buy-btn--compress[_ngcontent-%COMP%]{grid-row:1/2}.products__product[_ngcontent-%COMP%]   .products__product-add-btn[_ngcontent-%COMP%]{grid-row:2/3}.products__product[_ngcontent-%COMP%]   .products__product-delete-btn[_ngcontent-%COMP%]{grid-row:3/4}.products__product[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:105.6px}}\"],\n      changeDetection: 0\n    });\n  }\n  return ShopProductCollectionComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}